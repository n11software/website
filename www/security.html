<!DOCTYPE html>
<html>
  <head>
    <title>Account - N11</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Fast and secure software. Search the internet, for help, images, videos, everything!">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#f8f8f8">
    <link rel="stylesheet" href="/css/account.css">
    <link rel="stylesheet" href="/css/profile.css">
  </head>
  <body>
    [userinfo]
    <div class="nav">
        <a class="logo" href="/u/[user]">
            <svg width="50px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48.97 48.97">
                <defs>
                    <style>
                    .cls-1 {
                        fill: #1a1a1a;
                        stroke: #1a1a1a;
                        stroke-linejoin: round;
                        stroke-width: 3.97px;
                    }

                    .cls-1, .cls-2 {
                        stroke-linecap: round;
                    }

                    .cls-2, .cls-3 {
                        fill: none;
                        stroke: #fff;
                        stroke-miterlimit: 15.12;
                        stroke-width: 3.78px;
                    }
                    </style>
                </defs>
                <g>
                    <rect class="cls-1" x="1.99" y="1.99" width="45" height="45" rx="11.86" ry="11.86"/>
                </g>
                <g>
                    <circle class="cls-3" cx="24.49" cy="24.49" r="11.59"/>
                    <path class="cls-2" d="M9.04,36.07L39.94,12.9"/>
                </g>
            </svg>
        </a>
        <a class="link" href="/u/[user]/account">Account Info</a>
        <a class="link this" href="/u/[user]/account/security">Security</a>
        <a class="link" href="/u/[user]/account/history">History</a>
        
        <script src="/js/profile.js"></script>
    </div>
    <div class="content">
        <span class="title">Security</span>
        <div class="info">
            <a class="save" onclick="save()">Save</a>
            <div class="wrapper">
                <div class="left">
                    <span class="title">2FA</span>
                    <div class="options">
                        <span class="title">Enabled:</span>
                        <input type="checkbox" id="twofa" {2fa}>
                    </div>
                    <div class="twofa-info">
                        <div class="label">
                            <span class="title">2FA Type: </span>
                            <select>
                                <option value="b">Both</option>
                                <option value="p">Phone</option>
                                <option value="e">Email</option>
                            </select>
                        </div>
                        <div class="phones">
                            <span class="title">Phone Numbers:</span>
                            <div class="list">
                                [phones]
                            </div>
                            <a class="add" onclick="addPhone()">Add Phone</a>
                        </div>
                    </div>
                </div>
                <div class="right">
                    <span class="title">Password</span>
                </div>
            </div>
        </div>
    </div>
    <script>
        let phones = []
        let addPhone = () => {
            let phone = document.createElement("div");
            phone.className = "phone";
            phone.innerHTML = '<input type="text" placeholder="Phone Number"><a class="remove" onclick="removePhone(this)"><img src="/remove.svg"></a>';
            document.querySelector(".phones>.list").appendChild(phone);
        }

        let removePhone = (e) => {
            e.parentElement.remove();
        }

        let typeChanged = () => {
            let type = document.querySelector(".twofa-info .label select").value
            if (type == "e") document.querySelector(".twofa-info .phones").style.display = "none"
            else document.querySelector(".twofa-info .phones").style.display = "flex"
        }

        typeChanged()

        document.querySelector(".twofa-info .label select").onchange = typeChanged

        let twoFAChanged = () => {
            let twoFA = document.getElementById("twofa")
            if (twoFA.checked) document.querySelector('.twofa-info').style.display = "flex"
            else document.querySelector('.twofa-info').style.display = "none"
        }
        twoFAChanged()
        document.getElementById('twofa').onclick = twoFAChanged;
        let save = () => {
            let first = document.querySelector(".first").value;
            let last = document.querySelector(".last").value;
            let email = document.querySelector(".email").value;
            let dob = document.querySelector(".dob").value;
            let xhr = new XMLHttpRequest();
            xhr.open("POST", "/api/user/update");
            xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
            xhr.send("first=" + first + "&last=" + last + "&email=" + email + "&dob=" + dob);
            xhr.onload = () => {
                if (xhr.status == 200) {
                    window.location.reload();
                }
            }
        }
    </script>
  </body>
</html>